graph LR
    subgraph States
        Idle((Idle))
        PROCESSING((PROCESSING))
        BACKPRESSURE((BACKPRESSURE))
        ZERO_PADDING((ZERO_PADDING))
    end

    %% State Transitions
    Idle -- sink_sop = 1 & sink_valid = 1 --> PROCESSING
    PROCESSING -- sink_ready = 0 (Backpressure) --> BACKPRESSURE
    PROCESSING -- sink_eop = 1 & cell_incomplete = 1 --> ZERO_PADDING
    PROCESSING -- sink_eop = 1 & cell_incomplete = 0 --> Idle
    BACKPRESSURE -- sink_ready = 1 --> PROCESSING
    BACKPRESSURE -- sink_eop = 1 & cell_incomplete = 1 --> ZERO_PADDING
    ZERO_PADDING -- padding_complete = 1 --> Idle

    %% Styling
    style Idle fill:#f9f,stroke:#333,stroke-width:2px
    style PROCESSING fill:#f9f,stroke:#333,stroke-width:2px
    style BACKPRESSURE fill:#f9f,stroke:#333,stroke-width:2px
    style ZERO_PADDING fill:#f9f,stroke:#333,stroke-width:2px
    
    linkStyle 0,1,2,3,4,5,6 stroke:#333, stroke-width:2px;

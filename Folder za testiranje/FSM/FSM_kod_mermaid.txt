stateDiagram-v2
  direction LR
  [*] --> Idle
  Idle --> PROCESSING : sink_sop = 1 & sink_valid = 1
  PROCESSING --> BACKPRESSURE : sink_ready = 0 (Backpressure)
  PROCESSING --> ZERO_PADDING : sink_eop = 1 & cell_incomplete = 1
  PROCESSING --> Idle : sink_eop = 1 & cell_incomplete = 0
  BACKPRESSURE --> PROCESSING : sink_ready = 1
  BACKPRESSURE --> ZERO_PADDING : sink_eop = 1 & cell_incomplete = 1
  ZERO_PADDING --> Idle : padding_complete = 1

  state Idle {
    [*] --> Idle_state
    Idle_state --> [*] : state <= Idle
  }

  state PROCESSING {
    [*] --> PROCESSING_state
    PROCESSING_state --> [*] : state <= PROCESSING
  }

  state BACKPRESSURE {
    [*] --> BACKPRESSURE_state
    BACKPRESSURE_state --> [*] : state <= BACKPRESSURE
  }

  state ZERO_PADDING {
    [*] --> ZERO_PADDING_state
    ZERO_PADDING_state --> [*] : state <= ZERO_PADDING
  }

  Idle --> PROCESSING : source_valid = 1, source_data = sink_data
  PROCESSING --> PROCESSING : byte_counter += 1, source_valid = 1
  PROCESSING --> ZERO_PADDING : source_data = 0x00 (Zero Padding)
  PROCESSING --> Idle : source_eoc = 1
  BACKPRESSURE --> BACKPRESSURE : Hold State, source_valid = 0
  BACKPRESSURE --> ZERO_PADDING : Fill cell with padding, source_data = 0x00
  ZERO_PADDING --> Idle : source_eoc = 1, padding_complete
